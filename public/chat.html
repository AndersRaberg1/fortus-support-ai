<script>
  const messages = document.getElementById('messages');
  const input = document.getElementById('user-input');

  function addMessage(text, type) {
    const div = document.createElement('div');
    div.className = `message ${type}`;
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  async function sendMessage() {
    const question = input.value.trim();
    if (!question) return;
    addMessage(question, 'user');
    input.value = '';

    // Lägg till loading-meddelande
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'message ai';
    loadingDiv.textContent = 'Tänker...';
    messages.appendChild(loadingDiv);
    messages.scrollTop = messages.scrollHeight;

    try {
      const response = await fetch('https://fortus-support-ai.vercel.app/api/chat', {  // ABSOLUT URL här!
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: question })
      });

      const data = await response.json();

      // Ta bort loading och lägg till riktigt svar
      messages.removeChild(loadingDiv);
      addMessage(data.response || 'Just nu tar det lite längre tid – prova igen om en stund!', 'ai');
    } catch (error) {
      messages.removeChild(loadingDiv);
      addMessage('Oj, något gick fel med anslutningen. Prova igen eller ladda om sidan.', 'ai');
      console.error(error);
    }
  }

  input.addEventListener('keypress', e => { if (e.key === 'Enter') sendMessage(); });
</script>
